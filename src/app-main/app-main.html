<link
    rel="import"
    href="../../bower_components/polymer/polymer.html">
<link
    rel="import"
    href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link
    rel="import"
    href="../../bower_components/paper-button/paper-button.html">
<link
    rel="import"
    href="../../bower_components/paper-input/paper-input.html">
<link
    rel="import"
    href="../../bower_components/paper-styles/color.html">

<link
    rel="import"
    href="../date-select/date-select.html">
<link
    rel="import"
    href="../sketch-canvas/sketch-canvas.html">

<dom-module id="app-main">

  <template>

    <style is="custom-style" include="iron-flex iron-flex-alignment">
      :host {
        font-family: 'Roboto', 'Noto', sans-serif;
        font-size: 36pt;
        @apply(--layout-vertical);
        @apply(--layout-center);
        width: 100%;
        height: 100%;
      }
      textarea {
        font-family: 'Roboto', 'Noto', sans-serif;
        font-size: 36pt;
      }
      paper-input {
        margin: 0 10px 20px 10px;
        --paper-input-container-label: {
          font-size: 20pt !important;
        };
        --paper-input-container-input: {
          font-size: 36pt !important;
          height: 100px;
          margin-top: 10px;
        };
      }
      paper-button {
        font-size: 26pt !important;
      }
      paper-button.submit {
        color: white;
        background-color: var(--paper-green-800);
      }
      sketch-canvas {
        border: 1px solid black;
      }
      .page {
        @apply(--layout-vertical);
        height: 100%;
        width: 90%;
      }
      .card-content {
        @apply(--layout-flex);
      }
      .card-actions {
        @apply(--layout-flex-none);
        margin-top: 10px;
      }
    </style>

    <div id="page1" class="page" hidden$="[[ !_onPage(page, 1) ]]">

      <div class="card-content">

        <paper-input
            label="Your Name (First and Last)"
            value="{{ name }}"
        ></paper-input>

      </div>

      <div class="card-actions layout horizontal end-justified">
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page2" class="page" hidden$="[[ !_onPage(page, 2) ]]">

      <div class="card-content">

        <label>What is your date of birth?</label>
        <date-select value="{{ dob }}" initial-value="[[ dob ]]"></date-select>

      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page3" class="page" hidden$="[[ !_onPage(page, 3) ]]">

      <div class="card-content">

        <label>What is today's date?</label>
        <date-select value="{{ today }}" initial-value="[[ today ]]"></date-select>

      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page4" class="page" hidden$="[[ !_onPage(page, 4) ]]">

      <div class="card-content">
        <p>On the <span style="font-weight: bold">next to last question</span>, write the following words in any order:</p>
        <ul>
          <li>House</li>
          <li>Tree</li>
          <li>Music</li>
        </ul>
      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page5" class="page" hidden$="[[ !_onPage(page, 5) ]]">
      <div class="card-content layout vertical">
        <img src="../../images/wreath.jpg" class="self-center">
        <label>Name the picture shown above</label>
        <paper-input value="{{ picture1 }}"></paper-input>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>
    </div>

    <div id="page6" class="page" hidden$="[[ !_onPage(page, 6) ]]">
      <div class="card-content layout vertical">
        <img src="../../images/volcano.jpg" class="self-center">
        <label>Name the picture shown above</label>
        <paper-input value="{{ picture2 }}"></paper-input>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>
    </div>

    <div id="page7" class="page" hidden$="[[ !_onPage(page, 7) ]]">

      <div class="card-content">
        <label>
          How are a watch and a ruler similar? Write down how they are alike. They both are... what?
        </label>
        <paper-input value="{{ question1 }}"></paper-input>
      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page8" class="page" hidden$="[[ !_onPage(page, 8) ]]">

      <div class="card-content">
        <label>
          How many nickels are in 60 cents?
        </label>
        <paper-input value="{{ question2 }}"></paper-input>
      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page9" class="page" hidden$="[[ !_onPage(page, 9) ]]">

      <div class="card-content">
        <label>
          You are buying $13.45 of groceries. How much change would you receive back from a $20 bill?
        </label>
        <paper-input value="{{ question3 }}"></paper-input>
      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page10" class="page" hidden$="[[ !_onPage(page, 10) ]]">

      <div class="card-content">
        <p>On the <span style="font-weight: bold">last question</span>, write “I am done” on the blank line provided.</p>
      </div>

      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>

    </div>

    <div id="page11" class="page" hidden$="[[ !_onPage(page, 11) ]]">
      <div class="card-content layout vertical">
        <label class="flex-none">Draw a picture of a clock with the time set to 3:40</label>
        <sketch-canvas class="flex-auto"></sketch-canvas>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>
    </div>

    <div id="page12" class="page" hidden$="[[ !_onPage(page, 12) ]]">
      <div class="card-content layout vertical">
        <label>Write down the names of 12 different animals</label>
        <textarea rows="5" value="{{ animals::input }}"></textarea>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>
    </div>

    <div id="page13" class="page" hidden$="[[ !_onPage(page, 13) ]]">
      <div class="card-content">
        <label>
          What were the three words you were told to remember?
        </label>
        <paper-input value="{{ words }}"></paper-input>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>
          Next
        </paper-button>
      </div>
    </div>

    <div id="page14" class="page" hidden$="[[ !_onPage(page, 14) ]]">
      <div class="card-content">
        <label>
          Have you finished?
        </label>
        <paper-input value="{{ finished }}"></paper-input>
      </div>
      <div class="card-actions layout horizontal justified">
        <paper-button
            on-tap="_prevPage"
            raised>
          Back 
        </paper-button>
        <paper-button
            class="submit"
            on-tap="_nextPage"
            disabled="[[ _nextDisabled ]]"
            raised>Submit</paper-button>
      </div>
    </div>

    <div id="page15" class="page" hidden$="[[ !_onPage(page, 15) ]]">
      <div class="card-content">
        <p>Thank you, your score is {{ score }} / 27.</p>
      </div>
    </div>
    
  </template>

  <script>
    Polymer({
      is: 'app-main',
      properties: {
        page: {
          type: Number,
          value: () => { return parseInt(window.localStorage.getItem('page')) || 1 },
        },
        name: {
          type: String,
          value: () => { return window.localStorage.getItem('name') || '' },
        },
        dob: {
          type: Object,
          value: () => {
            return window.localStorage.getItem('dob') ?
              new Date(JSON.parse(window.localStorage.getItem('dob'))) : '';
          },
        },
        today: {
          type: Object,
          value: () => {
            return window.localStorage.getItem('today') ?
              new Date(JSON.parse(window.localStorage.getItem('today'))) : '';
          },
        },
        picture1: {
          type: String,
          value: () => { return window.localStorage.getItem('picture1') || '' },
        },
        picture2: {
          type: String,
          value: () => { return window.localStorage.getItem('picture2') || '' },
        },
        question1: {
          type: String,
          value: () => { return window.localStorage.getItem('question1') || '' },
        },
        question2: {
          type: String,
          value: () => { return window.localStorage.getItem('question2') || '' },
        },
        question3: {
          type: String,
          value: () => { return window.localStorage.getItem('question3') || '' },
        },
        animals: {
          type: String,
          value: () => { return window.localStorage.getItem('animals') || '' },
        },
        words: {
          type: String,
          value: () => { return window.localStorage.getItem('words') || '' },
        },
        finished: {
          type: String,
          value: () => { return window.localStorage.getItem('finished') || '' },
        },
        _nextDisabled: {
          type: Boolean,
          value: false,
        },
      },
      observers: [
        '_localStorage(page, "page")',
        '_localStorage(name, "name")',
        '_localStorage(dob, "dob")',
        '_localStorage(today, "today")',
        '_localStorage(picture1, "picture1")',
        '_localStorage(picture2, "picture2")',
        '_localStorage(question1, "question1")',
        '_localStorage(question2, "question2")',
        '_localStorage(question3, "question3")',
        '_localStorage(animals, "animals")',
        '_localStorage(words, "words")',
        '_localStorage(finished, "finished")',
      ],
      _onPage(onPage, wantPage) {
        return onPage == wantPage;
      },
      _nextPage() {
        this.page += 1;
        this.fire('pagechange', {
          page: this.page,
        });
        if (this.page === 15) {
          this._score();
        }
        this._nextDisabled = true;
        window.setTimeout(() => {
          this._nextDisabled = false;
        }, 1000);
      },
      _prevPage() {
        this.page -= 1;
        this.fire('pagechange', {
          page: this.page,
        });
      },
      _localStorage(newValue, field) {
        if (newValue instanceof Date) {
          window.localStorage.setItem(field, JSON.stringify(newValue));
        } else {
          window.localStorage.setItem(field, newValue);
        }
      },
      _score() {
        this.score = 0;

        const today = new Date();
        if (this.today && today.getDate() == this.today.getDate()) {
          this.score += 1;
        }
        if (this.today && today.getMonth() == this.today.getMonth()) {
          this.score += 1;
        }
        if (this.today && today.getFullYear() == this.today.getFullYear()) {
          this.score += 1;
        }

        if (this.picture1.toLowerCase() == 'wreath') {
          this.score += 1;
        }

        if (this.picture2.toLowerCase() == 'volcano') {
          this.score += 1;
        }

        if (this.question1.toLowerCase().includes('measure')) {
          this.score += 1;
        }

        if (this.question2.toLowerCase().includes('12')) {
          this.score += 1;
        }

        if (this.question3.toLowerCase().includes('6')) {
          this.score += 1;
        }

        if (this.question3.toLowerCase().includes('55')) {
          this.score += 1;
        }

        if (this.question3.toLowerCase().includes('6.55')) {
          this.score += 1;
        }

        const animals = this.animals.split(' ');
        this.score += animals.filter((a) => { return a.length >= 3 }).length;

        if (this.finished.toLowerCase().includes('done') ||
            this.finished.toLowerCase().includes('finished')) {
          this.score += 1;
        }

        if (this.finished.toLowerCase().includes('I am done')) {
          this.score += 1;
        }

        if (this.words.toLowerCase().includes('house')) {
          this.score += 1;
        }
        if (this.words.toLowerCase().includes('tree')) {
          this.score += 1;
        }
        if (this.words.toLowerCase().includes('music')) {
          this.score += 1;
        }

        window.localStorage.clear();

        return this.score;
      }
    });
  </script>

</dom-module>